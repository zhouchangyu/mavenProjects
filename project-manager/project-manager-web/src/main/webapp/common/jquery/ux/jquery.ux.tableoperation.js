(function($){Tee.TableOperation=function(cfg){var selCls=".ui-selected";$.extend(true,this,cfg);this.table=$(this.table);this.id=this.table.attr("id");var self=this;var dragColumns=this.table[0].rows[0].cells;if(!dragColumns){return}var dragColumnNo;var dragX;var saveOnmouseup;var saveOnmousemove;var saveBodyCursor;function preventEvent(e){var ev=e||window.event;if(ev.preventDefault){ev.preventDefault()}else{ev.returnValue=false}if(ev.stopPropagation){ev.stopPropagation()}return false}this.changeColumnWidth=function(no,w){if(!dragColumns){return false}if(no<0){return false}if(dragColumns.length<no){return false}if(parseInt(dragColumns[no].style.width)<=-w){return false}if(dragColumns[no+1]&&parseInt(dragColumns[no+1].style.width)<=w){return false}dragColumns[no].style.width=parseInt(dragColumns[no].style.width)+w+"px";if(dragColumns[no+1]){dragColumns[no+1].style.width=parseInt(dragColumns[no+1].style.width)-w+"px"}return true};this.columnDrag=function(e){var e=e||window.event;var X=e.clientX||e.pageX;if(!self.changeColumnWidth(dragColumnNo,X-dragX)){self.stopColumnDrag(e)}dragX=X;preventEvent(e);return false};this.stopColumnDrag=function(e){var e=e||window.event;if(!dragColumns){return}document.onmouseup=saveOnmouseup;document.onmousemove=saveOnmousemove;document.body.style.cursor=saveBodyCursor;var colWidth="";var separator="";for(var i=0;i<dragColumns.length;i++){colWidth+=separator+parseInt($(dragColumns[i]).width());separator="+"}preventEvent(e)};this.startColumnDrag=function(e){var e=e||window.event;dragColumnNo=(e.target||e.srcElement).parentNode.cellIndex;dragX=e.clientX||e.pageX;var colWidth=new Array();for(var i=0;i<dragColumns.length;i++){colWidth[i]=parseInt($(dragColumns[i]).width())}for(var i=0;i<dragColumns.length;i++){dragColumns[i].width="";dragColumns[i].style.width=colWidth[i]+"px"}saveOnmouseup=document.onmouseup;document.onmouseup=self.stopColumnDrag;saveBodyCursor=document.body.style.cursor;document.body.style.cursor="w-resize";saveOnmousemove=document.onmousemove;document.onmousemove=self.columnDrag;preventEvent(e)};for(var i=0;i<dragColumns.length;i++){var evt=$("<div></div>");evt.css({position:"relative",height:"30px","background-color":"gray",width:"5px",left:"100%","z-index":"1",cursor:"w-resize"});$(dragColumns[i]).append(evt);evt.mousedown(self.startColumnDrag)}this.table.selectable(this.selectable);if(this.sortable){this.table.find("td").sortable(this.sortable)}var mergeCells=function(append,cls){if(!verifyMerge()){return}cls=cls||".ui-selected";var cols=0,rows=0,total=0;self.table.find("td"+cls).eq(0).parent().children(cls).each(function(i,e){cols+=$(e).attr("colspan")||0});self.table.find("td"+cls).each(function(i,e){var col=$(e).attr("colspan")||0;var row=$(e).attr("rowspan")||0;total+=col*row});rows=total/cols;var td=$("td"+cls).first();self.table.find("td"+cls).each(function(i,e){if(i==0){$(e).attr("colspan",cols);$(e).attr("rowspan",rows)}else{if(append){$(e).children().each(function(j,el){td.append(el)})}$(e).remove()}})};function verifyMerge(cls){cls=cls||".ui-selected";var cells=0;var td=self.table.find("td"+cls).first();var left=td.attr("cellIndex");var right=td.attr("cellIndex")+td.attr("colSpan");var top=td.parent().attr("rowIndex");var bottom=td.parent().attr("rowIndex")+td.attr("rowSpan");self.table.find("td"+cls).each(function(i,e){var col=e.colSpan||0;var row=e.rowSpan||0;cells+=col*row;var rowIndex=e.parentNode.rowIndex;var cellIndex=e.cellIndex;if(rowIndex<top){top=rowIndex}if(rowIndex+row>bottom){bottom=rowIndex+row}if(cellIndex<left){left=cellIndex}if(cellIndex+col>right){right=cellIndex+col}});if(cells!=(right-left)*(bottom-top)){return false}return true}var splitCells=function(cls){cls=cls||".ui-selected";var cols=0,rows=0,total=0;$("td"+cls).eq(0).parent().children(cls).each(function(i,e){cols+=$(e).attr("colspan")||0});$("td"+cls).each(function(i,e){var col=$(e).attr("colspan")||0;$(e).attr("colspan",1);for(;col>1;col--){var copy=$(e).clone(true).empty();$(e).after(copy)}});$("td"+cls).each(function(i,e){var row=$(e).attr("rowspan")||0;$(e).attr("rowspan",1);var tr=$(e).parent();for(;row>1;row--){var copy=$(e).clone().empty();tr=tr.next().append(copy)}});if(self.sortable){self.table.find("td").sortable(this.sortable)}};var addRow=function(position,cls){position=position||"after";if(typeof position==="number"){if(this.table[0]&&this.table[0].rows.length>=position){var tr=this.table.find("tr").eq(position);var clone=tr.clone();clone.children().empty();tr.after(clone)}else{var tr=this.table.find("tr").eq(0);var clone=tr.clone();clone.children().empty();this.table.append(clone)}}else{if(typeof position==="string"){cls=cls||".ui-selected";var td=$("td"+cls).first();if(!td[0]){return}var tr=td.parent();var clone=tr.clone();clone.children().empty();if(position=="before"){tr.before(clone)}else{tr.after(clone)}}}};function unselect(){self.table.find(selCls).removeClass(selCls.replace(".",""))}return{mergeCells:mergeCells,splitCells:splitCells,addRow:addRow,unselect:unselect,verifyMerge:verifyMerge}}})(jQuery);