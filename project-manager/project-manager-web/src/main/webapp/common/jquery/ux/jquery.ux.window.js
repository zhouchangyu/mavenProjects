(function($){var opts={modal:false,draggable:{},width:300,id:"",tbar:[{id:"close"}],"float":true,borderHeight:40,modalCls:"",containment:"parent",activeCls:"window-active",renderTo:"body",cmpCls:"jq-window",height:300,maskOpacity:"0.5",closeAction:"close",src:"",posCenter:true,iframeSrc:"",icon:"",layer:"lower",layout:"autolayout",layoutCfg:{},plugins:[],cls:"",style:{},listeners:{resize:$.noop}};Tee.createComponent("Window",opts,Tee.Panel.prototype,{initComponent:function(){if(this.modal){this.layer="upper";this.createModalBg()}this.initContainer();Tee.Panel.prototype.initComponent.call(this)},show:function(){Tee.Panel.prototype.show.apply(this,arguments);this.modalBg&&this.modalBg.show()},hide:function(){Tee.Panel.prototype.hide.apply(this,arguments);this.modalBg&&this.modalBg.hide()},close:function(){Tee.Panel.prototype.close.apply(this,arguments)},initContainer:function(){this.el.addClass(this.cmpCls+"-container");this.el.css({width:this.width,"z-index":Tee.topZIndex(this.layer)});var t=this;this.el.hide();this.status.hidden=true;if(t.modalBg){Tee.Event.add(this,"bind","destroy","before",function(e,t){t.modalBg.remove()});$(window).resize(function(){t.modalBg.css({width:(document.documentElement||document.body).scrollWidth,height:(document.documentElement||document.body).scrollHeight})})}},createModalBg:function(){this.modalBg=$('<div class="'+this.cmpCls+'-mask"></div>');$("body").append(this.modalBg);var CSS={width:(document.documentElement||document.body).scrollWidth,height:(document.documentElement||document.body).scrollHeight,top:"0px","z-index":Tee.topZIndex(this.layer),left:"0px",display:"none",opacity:this.maskOpacity,filter:"alpha(opacity="+this.maskOpacity*100+");WIDTH: 100%"};this.modalBg.css(CSS);this.modalBg.addClass(this.modalCls);if(this.modalStyle){this.modalBg.css(this.modalStyle)}}});var windowMrgOpts={tray:null,container:null,items:[],activeWindow:null,activeBtn:null};Tee.createComponent("WindowMgr",windowMrgOpts,{initialize:function(){var self=this;$.each(this.items,function(i,e){self.addTrayBtn(e)})},addTrayBtn:function(win){var self=this;if(this.tray&&!win.trayBtn){var btn=new Tee.Button({status:{isPressed:!win.status.hidden},normalCls:"btn-icon",activeCls:"btn-icon-active",icon:win.icon,text:win.title,toggle:true,title:win.title,toggleHandler:[function(e,t,callback){win.show("normal",callback);win.active()},function(e,t,callback){win.hide("normal",callback)}]});Tee.Event.add(btn,"bind","destroy","before",function(e,t){self.tray.items=$.grep(self.items,function(n,i){return n.id!=t.id})});win.trayBtn=btn;this.tray.addItems(btn)}function doActive(e,t){if(!self.activeWindow){self.activeWindow=t;t.trayBtn.setStatus("active",true)}else{if(self.activeWindow.id!=t.id){self.activeWindow.trayBtn&&self.activeWindow.trayBtn.setStatus("default",true);self.activeWindow.deactive();self.activeWindow=t;t.trayBtn.setStatus("active",true)}}}function doHide(e,t){var id="",max=0;$.each(self.items,function(i,e){if(!e.status.hidden&&e.id!=t.id){if((e.zIndex||0)>max){max=e.zIndex||0;id=e.id}}});if(id){Tee.getCmp(id).active()}else{t.trayBtn&&t.trayBtn.setStatus("default",true)}}Tee.Event.add(win,"bind","active","after",doActive);Tee.Event.add(win,"bind","hide","after",doHide);Tee.Event.add(win,"bind","destroy","before",function(e,t){self.items=$.grep(self.items,function(n,i){return n.id!=t.id});t.trayBtn&&t.trayBtn.destroy()})},addItems:function(windows){var self=this;if(windows instanceof Array){$.each(windows,function(i,e){self.items.push(e);self.addTrayBtn(e)})}else{this.items.push(windows);this.addTrayBtn(windows)}},createWindow:function(cfg){var win=Tee.getCmp(cfg&&cfg.id);if(!win){win=new Tee.Window(cfg);win.el.addClass(this.cls);this.addItems(win)}win.active()},createPanel:function(cfg){if(!Tee.isCmp(cfg.parentCmp)){return}var panel=new Tee.Panel(cfg);this.addItems(panel);panel.active()},hideAll:function(){$.each(this.items,function(i,e){e.hide()})},removeAll:function(){$.each(this.items,function(i,e){Tee.isCmp(e)&&e.destroy()})},showAll:function(){$.each(this.items,function(i,e){e.show()})},getActive:function(){return this.activeWindow}})})(jQuery);